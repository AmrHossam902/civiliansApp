name: NationalRecords

services:

  FrontEnd: 
    build:
      context: ../FrontEnd
      dockerfile: dockerfile
      args:
        NEXT_PUBLIC_API_URL: ${PUBLIC_API_URL} 
        NEXT_PUBLIC_FRONTEND_URL: ${FRONTEND_PUBLIC_URL}
        FRONTEND_PORT: ${FRONTEND_PORT}
    restart: always
    image: nr-frontend
    ports:
      - 80:${FRONTEND_PORT}
    environment:
      NEXT_PUBLIC_API_URL: ${PUBLIC_API_URL}
      API_URL : ${API_URL}
      NEXT_PUBLIC_FRONTEND_URL: ${FRONTEND_PUBLIC_URL}

  BackEnd:
    build: ../graphql-api
    restart: always
    image: nr-backend
    ports:
      - ${API_PORT}:${API_PORT}
    environment:
      PUBLIC_FRONTEND_URL: ${FRONTEND_PUBLIC_URL}
      FRONT_URL:  ${FRONTEND_URL}
      DB_HOST: ${DB_HOST}
      DB_PORT: ${DB_PORT}
      DB_ROOT_PASSWORD: ${DB_PASSWORD}
      PORT: ${API_PORT}
    depends_on:
      - mysql

  mysql:
    image: mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}
    ports:
      - ${DB_PUBLIC_PORT}:${DB_PORT}
    volumes:
      - ./data:/docker-entrypoint-initdb.d

